@model IEnumerable<Civionics.Models.Reading>
@using System.Data;

@{
    ViewBag.Title = "Readings";
    // Layout = "~/Views/Shared/_Layout.cshtml";

    DataSet dataSet = new DataSet();
    DataTable dataTable = new DataTable("Table");

    dataTable.Columns.Add("LoggedTime", typeof(string));
    dataTable.Columns.Add("Data", typeof(double));
    dataSet.Tables.Add(dataTable);

    double minRecordedData = double.MaxValue;
    double maxRecordedData = double.MinValue;
    foreach(var reading in Model)
    { 
        dataTable.Rows.Add(reading.LoggedTime.ToString(), reading.Data);
        minRecordedData = Math.Min(minRecordedData, reading.Data);
        maxRecordedData = Math.Max(maxRecordedData, reading.Data);
    }
    
    var dataView = new DataView(dataSet.Tables["Table"]);

    var myChart = new Chart(width: 800, height: 600);
    myChart.AddTitle("Project ID: " + ViewData["projectid"] + " / " +
                     "Sensor ID: " + ViewData["sensorid"] + " / " + 
                     "Sensor Type: " + ViewData["type"] + " / " + 
                     "Site: " + ViewData["site"]);
	myChart.AddSeries(chartType: "Line",
		              xValue: dataView, xField: "LoggedTime",
                      yValues: dataView, yFields: "Data");                      
    myChart.SetXAxis("Time");
    myChart.SetYAxis("" + ViewData["units"], minRecordedData - 5, maxRecordedData + 5);
    myChart.Write(); //direct output to screen
}

